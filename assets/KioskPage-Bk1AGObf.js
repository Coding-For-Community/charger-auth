const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BxPU_Em5.js","assets/index-BFQOVUzx.js","assets/index-DlEsbloS.css"])))=>i.map(i=>d[i]);
import{j as e,r as x,_ as T}from"./index-BFQOVUzx.js";import{u as g,a as z,L as B}from"./perms-B5whhIIo.js";import{a as O,u as v,b as I,B as _,c as A,g as c,p as D,f as y}from"./fetchBackend-CCR6wj5K.js";import{S as M}from"./SignInButton-B9RFoAA3.js";import{g as R,O as L}from"./FocusTrap-BdU9v3ik.js";import{B as w,M as Q}from"./Modal-DnoLS-mA.js";import{T as S}from"./Title-BH1m6vur.js";import{T as q}from"./TextInput-BclMpEFl.js";import{T as p}from"./Text-sbDLHhCS.js";import{S as E}from"./Stack-DupoAFCA.js";import"./CloseButton-CwN5Zsm1.js";import"./Paper-pPSgbywW.js";var C={root:"m_7f854edf"};const K={position:{bottom:0,right:0},zIndex:R("modal"),withinPortal:!0},V=A((s,{zIndex:r,position:t})=>({root:{"--affix-z-index":r?.toString(),"--affix-top":c(t?.top),"--affix-left":c(t?.left),"--affix-bottom":c(t?.bottom),"--affix-right":c(t?.right)}})),j=O((s,r)=>{const t=v("Affix",K,s),{classNames:n,className:l,style:a,styles:o,unstyled:i,vars:u,portalProps:m,zIndex:k,withinPortal:f,position:b,attributes:h,...F}=t,P=I({name:"Affix",classes:C,props:t,className:l,style:a,classNames:n,styles:o,unstyled:i,attributes:h,vars:u,varsResolver:V});return e.jsx(L,{...m,withinPortal:f,children:e.jsx(_,{ref:r,...P("root"),...F})})});j.classes=C;j.displayName="@mantine/core/Affix";var N={root:"m_4451eb3a"};const d=D((s,r)=>{const t=v("Center",null,s),{classNames:n,className:l,style:a,styles:o,unstyled:i,vars:u,inline:m,mod:k,attributes:f,...b}=t,h=I({name:"Center",props:t,classes:N,className:l,style:a,classNames:n,styles:o,unstyled:i,attributes:f,vars:u});return e.jsx(_,{ref:r,mod:[{inline:m},k],...h("root"),...b})});d.classes=N;d.displayName="@mantine/core/Center";function $(s){const[r,t]=x.useState(!1),[n,l]=x.useState(""),a=g({queryKey:["manualCheckIn"],queryFn:async()=>{const o=parseInt(n);if(Number.isNaN(o))return window.alert("Invalid student ID"),!1;const i=await y("/checkin/runManual/",{method:"POST",credentials:"include",body:JSON.stringify({student_id:o})});switch(i.status){case 400:return window.alert("Invalid Student ID."),null;case 401:return window.alert("Dev error: insufficient perms(bruH)"),null;case 405:return window.alert("There are no free blocks to sign in to."),null;case 200:return(await i.json()).studentName;default:return window.alert("LMAO unknown error: "+i.status),null}},enabled:!1});return e.jsxs(e.Fragment,{children:[e.jsx(j,{bottom:200,w:"100%",display:s.perms?.manualCheckIn?void 0:"none",children:e.jsx(d,{children:e.jsx(w,{bg:"red",size:"lg",onClick:()=>t(!0),children:"Don't have a phone?"})})}),e.jsx(Q,{opened:r,onClose:()=>t(!1),children:a.data?e.jsxs(e.Fragment,{children:[e.jsxs(S,{mb:30,children:["Thanks for signing in, ",a.data,"!"]}),e.jsx(w,{onClick:()=>t(!1),children:"Ok"})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{mb:30,children:"Sign in manually"}),e.jsxs("form",{onSubmit:()=>a.refetch(),children:[e.jsx(q,{value:n,onChange:o=>l(o.target.value),placeholder:"Student ID(The numbers on your ID card)",size:"lg",radius:12,mb:20}),e.jsx(M,{submitting:a.isFetching})]})]})})]})}const G=x.lazy(()=>T(()=>import("./index-BxPU_Em5.js"),__vite__mapDeps([0,1,2])).then(s=>({default:s.QRCodeSVG})));function ae(){const s=z(),r=g({queryKey:["qrCodeToken"],queryFn:async()=>await(await y("/checkin/token/",{credentials:"include"})).json(),refetchInterval:n=>n.state.data?1e3*n.state.data.time_until_refresh:1e3,refetchOnMount:"always"}),t=g({queryKey:["currFreeBlock"],queryFn:async()=>(await(await y("/checkin/freeBlockNow/")).json()).curr_free_block});return t.isFetching||r.isLoading?e.jsxs(d,{style:{minHeight:"100vh"},children:[e.jsx(B,{size:"xl"}),e.jsx(p,{ml:"md",size:"lg",children:"Loading authentication and block info..."})]}):e.jsxs(e.Fragment,{children:[s.data?.isAdmin&&e.jsx($,{perms:s.data}),e.jsxs(E,{align:"center",justify:"center",h:"100vh",gap:0,children:[e.jsx(p,{fz:30,fw:"bold",mb:8,gradient:{from:"blue",to:"cyan",deg:90},children:t.data?"Scan the QR code to check in!":"You can't check in right now."}),e.jsx(p,{size:"lg",c:"dimmed",ta:"center",mb:20,children:t.data&&`Current Free Period: ${t.data} Block`}),e.jsx(G,{value:`https://coding-for-community.github.io/charger-auth/#/CheckInPage?last_token=${r.data.token}`,size:350})]})]})}export{ae as component};
