import{r as l,j as p,g as ee,S as te,A,B as f,s as P,C as S,q as F,D as j,E as z,F as se,G as re,H as ie,I as H,n as q,t as ae,o as ne,f as G}from"./index-CpXPMzny.js";import{B as x,k as N,f as oe,b as ce,u as he,c as le,g as ue}from"./polymorphic-factory-DVFjMKD1.js";import{E as _,f as de}from"./fetchBackend-CVLyjmH-.js";var m={root:"m_5ae2e3c",barsLoader:"m_7a2bd4cd",bar:"m_870bb79","bars-loader-animation":"m_5d2b3b9d",dotsLoader:"m_4e3f22d7",dot:"m_870c4af","loader-dots-animation":"m_aac34a1",ovalLoader:"m_b34414df","oval-loader-animation":"m_f8e89c4b"};const Y=l.forwardRef(({className:e,...t},s)=>p.jsxs(x,{component:"span",className:N(m.barsLoader,e),...t,ref:s,children:[p.jsx("span",{className:m.bar}),p.jsx("span",{className:m.bar}),p.jsx("span",{className:m.bar})]}));Y.displayName="@mantine/core/Bars";const J=l.forwardRef(({className:e,...t},s)=>p.jsxs(x,{component:"span",className:N(m.dotsLoader,e),...t,ref:s,children:[p.jsx("span",{className:m.dot}),p.jsx("span",{className:m.dot}),p.jsx("span",{className:m.dot})]}));J.displayName="@mantine/core/Dots";const X=l.forwardRef(({className:e,...t},s)=>p.jsx(x,{component:"span",className:N(m.ovalLoader,e),...t,ref:s}));X.displayName="@mantine/core/Oval";const Z={bars:Y,oval:X,dots:J},fe={loaders:Z,type:"oval"},pe=le((e,{size:t,color:s})=>({root:{"--loader-size":ue(t,"loader-size"),"--loader-color":s?ee(s,e):void 0}})),U=oe((e,t)=>{const s=ce("Loader",fe,e),{size:r,color:a,type:h,vars:i,className:g,style:o,classNames:u,styles:n,unstyled:y,loaders:c,variant:E,children:O,attributes:v,...C}=s,R=he({name:"Loader",props:s,classes:m,className:g,style:o,classNames:u,styles:n,unstyled:y,attributes:v,vars:i,varsResolver:pe});return O?p.jsx(x,{...R("root"),ref:t,...C,children:O}):p.jsx(x,{...R("root"),ref:t,component:c[h],variant:E,size:r,...C})});U.defaultLoaders=Z;U.classes=m;U.displayName="@mantine/core/Loader";var me=class extends te{constructor(e,t){super(),this.options=t,this.#s=e,this.#i=null,this.#r=A(),this.bindMethods(),this.setOptions(t)}#s;#e=void 0;#p=void 0;#t=void 0;#n;#l;#r;#i;#m;#u;#d;#o;#c;#a;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),V(this.#e,this.options)?this.#h():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return D(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return D(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#R(),this.#w(),this.#e.removeObserver(this)}setOptions(e){const t=this.options,s=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof f(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#O(),this.#e.setOptions(this.options),t._defaulted&&!P(this.options,t)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const r=this.hasListeners();r&&K(this.#e,s,this.options,t)&&this.#h(),this.updateResult(),r&&(this.#e!==s||f(this.options.enabled,this.#e)!==f(t.enabled,this.#e)||S(this.options.staleTime,this.#e)!==S(t.staleTime,this.#e))&&this.#b();const a=this.#v();r&&(this.#e!==s||f(this.options.enabled,this.#e)!==f(t.enabled,this.#e)||a!==this.#a)&&this.#g(a)}getOptimisticResult(e){const t=this.#s.getQueryCache().build(this.#s,e),s=this.createResult(t,e);return ve(this,s)&&(this.#t=s,this.#l=this.options,this.#n=this.#e.state),s}getCurrentResult(){return this.#t}trackResult(e,t){return new Proxy(e,{get:(s,r)=>(this.trackProp(r),t?.(r),r==="promise"&&!this.options.experimental_prefetchInRender&&this.#r.status==="pending"&&this.#r.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(s,r))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#s.defaultQueryOptions(e),s=this.#s.getQueryCache().build(this.#s,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#h({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#h(e){this.#O();let t=this.#e.fetch(this.options,e);return e?.throwOnError||(t=t.catch(F)),t}#b(){this.#R();const e=S(this.options.staleTime,this.#e);if(j||this.#t.isStale||!z(e))return;const s=se(this.#t.dataUpdatedAt,e)+1;this.#o=setTimeout(()=>{this.#t.isStale||this.updateResult()},s)}#v(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#g(e){this.#w(),this.#a=e,!(j||f(this.options.enabled,this.#e)===!1||!z(this.#a)||this.#a===0)&&(this.#c=setInterval(()=>{(this.options.refetchIntervalInBackground||re.isFocused())&&this.#h()},this.#a))}#y(){this.#b(),this.#g(this.#v())}#R(){this.#o&&(clearTimeout(this.#o),this.#o=void 0)}#w(){this.#c&&(clearInterval(this.#c),this.#c=void 0)}createResult(e,t){const s=this.#e,r=this.options,a=this.#t,h=this.#n,i=this.#l,o=e!==s?e.state:this.#p,{state:u}=e;let n={...u},y=!1,c;if(t._optimisticResults){const d=this.hasListeners(),I=!d&&V(e,t),w=d&&K(e,s,t,r);(I||w)&&(n={...n,...ie(u.data,e.options)}),t._optimisticResults==="isRestoring"&&(n.fetchStatus="idle")}let{error:E,errorUpdatedAt:O,status:v}=n;c=n.data;let C=!1;if(t.placeholderData!==void 0&&c===void 0&&v==="pending"){let d;a?.isPlaceholderData&&t.placeholderData===i?.placeholderData?(d=a.data,C=!0):d=typeof t.placeholderData=="function"?t.placeholderData(this.#d?.state.data,this.#d):t.placeholderData,d!==void 0&&(v="success",c=H(a?.data,d,t),y=!0)}if(t.select&&c!==void 0&&!C)if(a&&c===h?.data&&t.select===this.#m)c=this.#u;else try{this.#m=t.select,c=t.select(c),c=H(a?.data,c,t),this.#u=c,this.#i=null}catch(d){this.#i=d}this.#i&&(E=this.#i,c=this.#u,O=Date.now(),v="error");const R=n.fetchStatus==="fetching",T=v==="pending",Q=v==="error",M=T&&R,B=c!==void 0,b={status:v,fetchStatus:n.fetchStatus,isPending:T,isSuccess:v==="success",isError:Q,isInitialLoading:M,isLoading:M,data:c,dataUpdatedAt:n.dataUpdatedAt,error:E,errorUpdatedAt:O,failureCount:n.fetchFailureCount,failureReason:n.fetchFailureReason,errorUpdateCount:n.errorUpdateCount,isFetched:n.dataUpdateCount>0||n.errorUpdateCount>0,isFetchedAfterMount:n.dataUpdateCount>o.dataUpdateCount||n.errorUpdateCount>o.errorUpdateCount,isFetching:R,isRefetching:R&&!T,isLoadingError:Q&&!B,isPaused:n.fetchStatus==="paused",isPlaceholderData:y,isRefetchError:Q&&B,isStale:k(e,t),refetch:this.refetch,promise:this.#r,isEnabled:f(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const d=L=>{b.status==="error"?L.reject(b.error):b.data!==void 0&&L.resolve(b.data)},I=()=>{const L=this.#r=b.promise=A();d(L)},w=this.#r;switch(w.status){case"pending":e.queryHash===s.queryHash&&d(w);break;case"fulfilled":(b.status==="error"||b.data!==w.value)&&I();break;case"rejected":(b.status!=="error"||b.error!==w.reason)&&I();break}}return b}updateResult(){const e=this.#t,t=this.createResult(this.#e,this.options);if(this.#n=this.#e.state,this.#l=this.options,this.#n.data!==void 0&&(this.#d=this.#e),P(t,e))return;this.#t=t;const s=()=>{if(!e)return!0;const{notifyOnChangeProps:r}=this.options,a=typeof r=="function"?r():r;if(a==="all"||!a&&!this.#f.size)return!0;const h=new Set(a??this.#f);return this.options.throwOnError&&h.add("error"),Object.keys(this.#t).some(i=>{const g=i;return this.#t[g]!==e[g]&&h.has(g)})};this.#C({listeners:s()})}#O(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const t=this.#e;this.#e=e,this.#p=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#C(e){q.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function be(e,t){return f(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function V(e,t){return be(e,t)||e.state.data!==void 0&&D(e,t,t.refetchOnMount)}function D(e,t,s){if(f(t.enabled,e)!==!1&&S(t.staleTime,e)!=="static"){const r=typeof s=="function"?s(e):s;return r==="always"||r!==!1&&k(e,t)}return!1}function K(e,t,s,r){return(e!==t||f(r.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&k(e,s)}function k(e,t){return f(t.enabled,e)!==!1&&e.isStaleByTime(S(t.staleTime,e))}function ve(e,t){return!P(e.getCurrentResult(),t)}var $=l.createContext(!1),ge=()=>l.useContext($);$.Provider;function ye(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Re=l.createContext(ye()),we=()=>l.useContext(Re),Oe=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},Ce=e=>{l.useEffect(()=>{e.clearReset()},[e])},Se=({result:e,errorResetBoundary:t,throwOnError:s,query:r,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(a&&e.data===void 0||ae(s,[e.error,r])),xe=e=>{if(e.suspense){const t=r=>r==="static"?r:Math.max(r??1e3,1e3),s=e.staleTime;e.staleTime=typeof s=="function"?(...r)=>t(s(...r)):t(s),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Ee=(e,t)=>e.isLoading&&e.isFetching&&!t,Ie=(e,t)=>e?.suspense&&t.isPending,W=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function Le(e,t,s){const r=ge(),a=we(),h=ne(),i=h.defaultQueryOptions(e);h.getDefaultOptions().queries?._experimental_beforeQuery?.(i),i._optimisticResults=r?"isRestoring":"optimistic",xe(i),Oe(i,a),Ce(a);const g=!h.getQueryCache().get(i.queryHash),[o]=l.useState(()=>new t(h,i)),u=o.getOptimisticResult(i),n=!r&&e.subscribed!==!1;if(l.useSyncExternalStore(l.useCallback(y=>{const c=n?o.subscribe(q.batchCalls(y)):F;return o.updateResult(),c},[o,n]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),l.useEffect(()=>{o.setOptions(i)},[i,o]),Ie(i,u))throw W(i,o,a);if(Se({result:u,errorResetBoundary:a,throwOnError:i.throwOnError,query:h.getQueryCache().get(i.queryHash),suspense:i.suspense}))throw u.error;return h.getDefaultOptions().queries?._experimental_afterQuery?.(i,u),i.experimental_prefetchInRender&&!j&&Ee(u,r)&&(g?W(i,o,a):h.getQueryCache().get(i.queryHash)?.promise)?.catch(F).finally(()=>{o.updateResult()}),i.notifyOnChangeProps?u:o.trackResult(u)}function Te(e,t){return Le(e,me)}async function Qe(){const e=await de("/checkin/perms/",{credentials:"include"});if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();return console.log(t),t}function De(){const e=G();return Te({queryKey:["loggedIn"],queryFn:async()=>{const t=await Qe();return t.isAdmin||(console.log("attempting navigate"),e({to:"/AdminLogin",search:()=>({redirectUrl:window.location.hash})})),t},retry:!1})}function Ne(){const e=G(),t=window.localStorage.getItem(_)??"";return l.useEffect(()=>{(!t||t==="")&&e({to:"/LoginPage",search:()=>({redirectUrl:window.location.hash})})},[]),{email:t,setEmail(s){window.localStorage.setItem(_,s)},removeEmail(){window.localStorage.removeItem(_)}}}export{U as L,Te as a,Ne as b,De as u};
