import{j as b,P as T,Q as k,r as C}from"./index-BqTru8hP.js";import{a as q,u as z,b as A,B as F,c as B,i as G}from"./fetchBackend-C9uYacD6.js";import{C as L}from"./Card-BtuWUlk7.js";import{T as N}from"./Title-CKNj1X-Y.js";import{T as H}from"./Text-CFB5sB-0.js";import{G as Q}from"./Group-ZifPxGuY.js";import{B as J}from"./Button-Ce4tf8zp.js";import"./Paper-BqMcMbvK.js";import"./perms-Ci-WEFVW.js";import"./UnstyledButton-rzi-lcRA.js";var R={root:"m_7485cace"};const V=B((M,{size:U,fluid:h})=>({root:{"--container-size":h?void 0:G(U,"container-size")}})),_=q((M,U)=>{const h=z("Container",null,M),{classNames:y,className:v,style:s,styles:r,unstyled:a,vars:f,fluid:w,mod:S,attributes:x,strategy:d,...o}=h,e=A({name:"Container",classes:R,props:h,className:v,style:s,classNames:y,styles:r,unstyled:a,attributes:x,vars:f,varsResolver:V});return b.jsx(F,{ref:U,mod:[{fluid:w,strategy:d||"block"},S],...e("root"),...o})});_.classes=R;_.displayName="@mantine/core/Container";var O={exports:{}},K=O.exports,P;function X(){return P||(P=1,(function(M,U){(function(y,v){M.exports=v(T())})(K,function(h){return(function(y){var v={};function s(r){if(v[r])return v[r].exports;var a=v[r]={i:r,l:!1,exports:{}};return y[r].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=y,s.c=v,s.d=function(r,a,f){s.o(r,a)||Object.defineProperty(r,a,{enumerable:!0,get:f})},s.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},s.t=function(r,a){if(a&1&&(r=s(r)),a&8||a&4&&typeof r=="object"&&r&&r.__esModule)return r;var f=Object.create(null);if(s.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:r}),a&2&&typeof r!="string")for(var w in r)s.d(f,w,(function(S){return r[S]}).bind(null,w));return f},s.n=function(r){var a=r&&r.__esModule?function(){return r.default}:function(){return r};return s.d(a,"a",a),a},s.o=function(r,a){return Object.prototype.hasOwnProperty.call(r,a)},s.p="",s(s.s="./src/react-webcam.tsx")})({"./src/react-webcam.tsx":(function(y,v,s){s.r(v);var r=s("react"),a=(function(){var d=function(o,e){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},d(o,e)};return function(o,e){d(o,e);function t(){this.constructor=o}o.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}})(),f=function(){return f=Object.assign||function(d){for(var o,e=1,t=arguments.length;e<t;e++){o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(d[n]=o[n])}return d},f.apply(this,arguments)},w=function(d,o){var e={};for(var t in d)Object.prototype.hasOwnProperty.call(d,t)&&o.indexOf(t)<0&&(e[t]=d[t]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(d);n<t.length;n++)o.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(d,t[n])&&(e[t[n]]=d[t[n]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(o){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,n){e.call(navigator,o,t,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function S(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var x=(function(d){a(o,d);function o(e){var t=d.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return o.prototype.componentDidMount=function(){var e=this,t=e.state,n=e.props;if(this.unmounted=!1,!S()){n.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),n.children&&typeof n.children!="function"&&console.warn("children must be a function")},o.prototype.componentDidUpdate=function(e){var t=this.props;if(!S()){t.onUserMediaError("getUserMedia not supported");return}var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),i=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),m=e.minScreenshotWidth!==t.minScreenshotWidth,l=e.minScreenshotHeight!==t.minScreenshotHeight;(i||m||l)&&(this.canvas=null,this.ctx=null),(n||i)&&(this.stopAndCleanup(),this.requestUserMedia())},o.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},o.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},o.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(o.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},o.prototype.getScreenshot=function(e){var t=this,n=t.state,i=t.props;if(!n.hasUserMedia)return null;var m=this.getCanvas(e);return m&&m.toDataURL(i.screenshotFormat,i.screenshotQuality)},o.prototype.getCanvas=function(e){var t=this,n=t.state,i=t.props;if(!this.video||!n.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var m=this.video.videoWidth,l=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var u=m/l;m=i.minScreenshotWidth||this.video.clientWidth,l=m/u,i.minScreenshotHeight&&l<i.minScreenshotHeight&&(l=i.minScreenshotHeight,m=l*u)}this.canvas=document.createElement("canvas"),this.canvas.width=e?.width||m,this.canvas.height=e?.height||l,this.ctx=this.canvas.getContext("2d")}var g=this,p=g.ctx,c=g.canvas;return p&&c&&(c.width=e?.width||c.width,c.height=e?.height||c.height,i.mirrored&&(p.translate(c.width,0),p.scale(-1,1)),p.imageSmoothingEnabled=i.imageSmoothing,p.drawImage(this.video,0,0,e?.width||c.width,e?.height||c.height),i.mirrored&&(p.scale(-1,1),p.translate(-c.width,0))),c},o.prototype.requestUserMedia=function(){var e=this,t=this.props,n=function(l,u){var g={video:typeof u<"u"?u:!0};t.audio&&(g.audio=typeof l<"u"?l:!0),e.requestUserMediaId++;var p=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(g).then(function(c){e.unmounted||p!==e.requestUserMediaId?o.stopMediaStream(c):e.handleUserMedia(null,c)}).catch(function(c){e.handleUserMedia(c)})};if("mediaDevices"in navigator)n(t.audioConstraints,t.videoConstraints);else{var i=function(l){return{optional:[{sourceId:l}]}},m=function(l){var u=l.deviceId;return typeof u=="string"?u:Array.isArray(u)&&u.length>0?u[0]:typeof u=="object"&&u.ideal?u.ideal:null};MediaStreamTrack.getSources(function(l){var u=null,g=null;l.forEach(function(j){j.kind==="audio"?u=j.id:j.kind==="video"&&(g=j.id)});var p=m(t.audioConstraints);p&&(u=p);var c=m(t.videoConstraints);c&&(g=c),n(i(u),i(g))})}},o.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t){this.setState({hasUserMedia:!1}),n.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},o.prototype.render=function(){var e=this,t=this,n=t.state,i=t.props,m=i.audio;i.forceScreenshotSourceSize;var l=i.disablePictureInPicture;i.onUserMedia,i.onUserMediaError,i.screenshotFormat,i.screenshotQuality,i.minScreenshotWidth,i.minScreenshotHeight,i.audioConstraints,i.videoConstraints,i.imageSmoothing;var u=i.mirrored,g=i.style,p=g===void 0?{}:g,c=i.children,j=w(i,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),E=u?f(f({},p),{transform:(p.transform||"")+" scaleX(-1)"}):p,I={getScreenshot:this.getScreenshot.bind(this)};return r.createElement(r.Fragment,null,r.createElement("video",f({autoPlay:!0,disablePictureInPicture:l,src:n.src,muted:!m,playsInline:!0,ref:function(W){e.video=W},style:E},j)),c&&c(I))},o.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},o})(r.Component);v.default=x}),react:(function(y,v){y.exports=h})}).default})})(O)),O.exports}var $=X();const Y=k($);function de(M){const U=C.useRef(null),h=C.useRef(null),[y,v]=C.useState(!1),[s,r]=C.useState(!1);async function a(){if(y||!U.current?.video)return;v(!0);const w=U.current.video.srcObject,S=[];h.current=new MediaRecorder(w,{mimeType:"video/webm"}),h.current.ondataavailable=x=>{x.data.size>0&&S.push(x.data)},h.current.onstop=async()=>{v(!1),r(!0);const x=new Blob(S,{type:"video/webm"}),d=new File([x],"facecheck.webm",{type:"video/webm"});await M.onSend(d),r(!1)},h.current.start()}function f(){h.current&&y&&h.current.stop()}return C.useEffect(()=>{h.current!=null&&a()},[h.current]),b.jsx(_,{mt:10,size:"sm",style:{display:"flex",justifyContent:"center",minHeight:"100vh",alignItems:"center"},children:b.jsxs(L,{shadow:"lg",radius:"lg",p:"xl",withBorder:!0,style:{textAlign:"center",width:"100%",maxWidth:400},children:[b.jsx(N,{order:2,mb:"sm",children:M.title}),b.jsx(H,{c:"dimmed",mb:"lg",children:M.subtitle}),b.jsx("div",{style:{position:"relative",width:"100%",aspectRatio:"1/1",borderRadius:16,overflow:"hidden",border:"4px solid #dee2e6"},children:b.jsx(Y,{ref:U,audio:!1,screenshotFormat:"image/jpeg",style:{width:"100%",height:"100%",objectFit:"cover"},videoConstraints:{facingMode:"environment"}})}),b.jsx(Q,{justify:"center",mt:"lg",children:b.jsx(J,{onClick:f,loading:s,children:s?"Uploading...":"Send"})})]})})}export{de as default};
