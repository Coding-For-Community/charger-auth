const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DzWSTd1Q.js","assets/index-CC56G5_e.js","assets/index-DlEsbloS.css"])))=>i.map(i=>d[i]);
import{j as e,r as u,_ as v}from"./index-CC56G5_e.js";import{u as m,a as _,L as C}from"./perms-LoylBixb.js";import{a as P,u as T,b as z,B as F,c as B,g as c,f}from"./fetchBackend-C7S8r053.js";import{S as N}from"./SignInButton-D8l85-iW.js";import{g as O,O as A}from"./FocusTrap-Cu1gqgH6.js";import{C as p}from"./Center-5oJxb3tf.js";import{B as x,M as D}from"./Modal-DbxjotcM.js";import{T as g}from"./Title-Bf1yYgju.js";import{T as M}from"./TextInput-D9UYceVo.js";import{T as d}from"./Text-BWtQSuAU.js";import{S as R}from"./Stack-uBCuJ1mm.js";import"./CloseButton-BwyggIXQ.js";var j={root:"m_7f854edf"};const L={position:{bottom:0,right:0},zIndex:O("modal"),withinPortal:!0},Q=B((n,{zIndex:s,position:t})=>({root:{"--affix-z-index":s?.toString(),"--affix-top":c(t?.top),"--affix-left":c(t?.left),"--affix-bottom":c(t?.bottom),"--affix-right":c(t?.right)}})),h=P((n,s)=>{const t=T("Affix",L,n),{classNames:r,className:l,style:a,styles:o,unstyled:i,vars:k,portalProps:y,zIndex:K,withinPortal:b,position:V,attributes:w,...I}=t,S=z({name:"Affix",classes:j,props:t,className:l,style:a,classNames:r,styles:o,unstyled:i,attributes:w,vars:k,varsResolver:Q});return e.jsx(A,{...y,withinPortal:b,children:e.jsx(F,{ref:s,...S("root"),...I})})});h.classes=j;h.displayName="@mantine/core/Affix";function q(n){const[s,t]=u.useState(!1),[r,l]=u.useState(""),a=m({queryKey:["manualCheckIn"],queryFn:async()=>{const o=parseInt(r);if(Number.isNaN(o))return window.alert("Invalid student ID"),!1;const i=await f("/checkin/runManual/",{method:"POST",credentials:"include",body:JSON.stringify({student_id:o})});switch(i.status){case 400:return window.alert("Invalid Student ID."),null;case 401:return window.alert("Dev error: insufficient perms(bruH)"),null;case 405:return window.alert("There are no free blocks to sign in to."),null;case 200:return(await i.json()).studentName;default:return window.alert("LMAO unknown error: "+i.status),null}},enabled:!1});return e.jsxs(e.Fragment,{children:[e.jsx(h,{bottom:200,w:"100%",display:n.perms?.manualCheckIn?void 0:"none",children:e.jsx(p,{children:e.jsx(x,{bg:"red",size:"lg",onClick:()=>t(!0),children:"Don't have a phone?"})})}),e.jsx(D,{opened:s,onClose:()=>t(!1),children:a.data?e.jsxs(e.Fragment,{children:[e.jsxs(g,{mb:30,children:["Thanks for signing in, ",a.data,"!"]}),e.jsx(x,{onClick:()=>t(!1),children:"Ok"})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{mb:30,children:"Sign in manually"}),e.jsxs("form",{onSubmit:()=>a.refetch(),children:[e.jsx(M,{value:r,onChange:o=>l(o.target.value),placeholder:"Student ID(The numbers on your ID card)",size:"lg",radius:12,mb:20}),e.jsx(N,{submitting:a.isFetching})]})]})})]})}const E=u.lazy(()=>v(()=>import("./index-DzWSTd1Q.js"),__vite__mapDeps([0,1,2])).then(n=>({default:n.QRCodeSVG})));function re(){const n=_(),s=m({queryKey:["qrCodeToken"],queryFn:async()=>await(await f("/checkin/token/",{credentials:"include"})).json(),refetchInterval:r=>r.state.data?1e3*r.state.data.time_until_refresh:1e3,refetchOnMount:"always"}),t=m({queryKey:["currFreeBlock"],queryFn:async()=>(await(await f("/checkin/freeBlockNow/")).json()).curr_free_block});return t.isFetching||s.isLoading?e.jsxs(p,{style:{minHeight:"100vh"},children:[e.jsx(C,{size:"xl"}),e.jsx(d,{ml:"md",size:"lg",children:"Loading authentication and block info..."})]}):e.jsxs(e.Fragment,{children:[n.data?.isAdmin&&e.jsx(q,{perms:n.data}),e.jsxs(R,{align:"center",justify:"center",h:"100vh",gap:0,children:[e.jsx(d,{fz:30,fw:"bold",mb:8,gradient:{from:"blue",to:"cyan",deg:90},children:t.data?"Scan the QR code to check in!":"You can't check in right now."}),e.jsx(d,{size:"lg",c:"dimmed",ta:"center",mb:20,children:t.data&&`Current Free Period: ${t.data} Block`}),e.jsx(E,{value:`https://coding-for-community.github.io/charger-auth/#/CheckInPage?last_token=${s.data.token}`,size:350})]})]})}export{re as component};
